sequenceDiagram
    participant 用户
    participant 本地系统
    participant 云服务器

%% ===== 主流程 =====
    用户->>本地系统: 启动代码同步功能
    本地系统->>云服务器: 建立安全连接
    Note right of 本地系统: 步骤1：准备阶段<br/>- 验证用户身份<br/>- 连接数据中心

    loop 自动检查更新
        本地系统->>本地系统: 扫描所有代码文件
        Note right of 本地系统: 步骤2：创建文件指纹<br/>- 识别197个重要文件<br/>- 生成唯一识别码
    end

    本地系统->>云服务器: 发送当前文件状态
    云服务器-->>本地系统: 反馈差异报告
    Note left of 云服务器: 步骤3：智能比对<br/>- 发现5个文件需要更新<br/>- 包括package.json

    par 并行传输
        本地系统->>云服务器: 上传变更文件1
        本地系统->>云服务器: 上传变更文件2
        Note over 本地系统,云服务器: 步骤4：高效传输<br/>- 自动选择最快线路<br/>- 断点续传保障
    end

    云服务器->>云服务器: 构建搜索索引
    云服务器-->>本地系统: 同步完成确认
    本地系统-->>用户: 显示绿色完成状态
    Note over 用户,本地系统: 总耗时5.5秒<br/>更新197个文件

%% ===== 异常处理场景 =====
    alt 网络中断
        本地系统->>本地系统: 自动保存进度
        loop 每30秒重试
            本地系统->>云服务器: 重新连接
            云服务器-->>本地系统: 继续传输
        end
    end